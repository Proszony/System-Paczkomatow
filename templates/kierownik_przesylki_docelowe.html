{% extends "base.html" %}
{% block title %}Przesy≈Çki do centrum{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1>üì• Przesy≈Çki do Twojego centrum</h1>
        <a href="{{ url_for('kierownik.dashboard') }}" class="btn btn-outline-secondary btn-sm">
            ‚Üê Panel kierownika
        </a>
    </div>

    {% if przesylki %}
    <form method="post" id="formPrzesylki">
        <!-- Przyciski zaznaczajƒÖce po statusie -->
        <div class="mb-2 d-flex gap-2">
            <button type="button" class="btn btn-sm btn-outline-secondary" id="select_w_trasie">
                Zaznacz wszystkie ‚ÄûW transporcie‚Äù
            </button>
            <button type="button" class="btn btn-sm btn-outline-secondary" id="select_przyjete">
                Zaznacz wszystkie ‚ÄûPrzyjeta w centrum‚Äù
            </button>
        </div>

        <div class="table-responsive">
            <table class="table table-striped align-middle">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" id="check_all">
                        </th>
                        <th>ID</th>
                        <th>Numer</th>
                        <th>Nadawca</th>
                        <th>Odbiorca</th>
                        <th>Paczkomat nadania</th>
                        <th>Paczkomat docelowy</th>
                        <th>Data nadania</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for p in przesylki %}
                    <tr>
                        <td>
                            <input type="checkbox" name="przesylki_ids" value="{{ p.id }}">
                        </td>
                        <td>{{ p.id }}</td>
                        <td><code>{{ p.numer_przesylki }}</code></td>
                        <td>{{ p.nadawca }}</td>
                        <td>{{ p.odbiorca }}</td>
                        <td>{{ p.paczkomat_nadania }}</td>
                        <td>{{ p.paczkomat_docelowy }}</td>
                        <td>{{ p.data_nadania.strftime("%Y-%m-%d %H:%M") if p.data_nadania else "-" }}</td>
                        <td class="status-col">{{ p.status }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Przyciski zbiorcze -->
        <div class="mt-3 d-flex gap-2">
            <button type="submit"
                    class="btn btn-success"
                    formaction="{{ url_for('kierownik.przyjmij_z_trasy_batch') }}">
                ‚úÖ Przyjmij zaznaczone z trasy
            </button>

            <button type="submit"
                    class="btn btn-primary"
                    formaction="{{ url_for('kierownik.dorecz_do_paczkomatu_batch') }}">
                üì¶ Dorƒôcz zaznaczone do paczkomatu
            </button>
        </div>
    </form>
    {% else %}
    <div class="alert alert-info">
        Brak przesy≈Çek w drodze do Twojego centrum.
    </div>
    {% endif %}
</div>

<script>
    // Zaznacz/odznacz wszystkie
    document.getElementById('check_all')?.addEventListener('change', function(e) {
        const checked = e.target.checked;
        document.querySelectorAll('input[name="przesylki_ids"]').forEach(cb => {
            cb.checked = checked;
        });
    });

    // Zaznacz wszystkie z wybranym statusem
    function selectByStatus(targetStatus) {
        document.querySelectorAll('#formPrzesylki tbody tr').forEach(tr => {
            const statusCell = tr.querySelector('.status-col');
            const cb = tr.querySelector('input[name="przesylki_ids"]');
            if (!statusCell || !cb) return;
            const statusText = statusCell.innerText.trim();
            cb.checked = (statusText === targetStatus);
        });
    }

    document.getElementById('select_w_trasie')?.addEventListener('click', () => {
        selectByStatus('W transporcie');          // dok≈Çadnie jak w status_przesylki
    });

    document.getElementById('select_przyjete')?.addEventListener('click', () => {
        selectByStatus('Przyjeta w centrum');     // dok≈Çadnie jak w status_przesylki
    })
</script>
{% endblock %}
